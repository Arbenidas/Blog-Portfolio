<main class="logs-main" id="logs">
  <div class="coffee-stain" style="top: 8rem; left: 2.5rem; opacity: 0.7;"></div>
  <div class="coffee-stain" style="top: 24rem; right: 5rem; opacity: 0.4; transform: scale(1.25);"></div>

  <div class="logs-content-grid">
    <!-- LEFT SIDEBAR -->
    <aside class="logs-sidebar">
      <!-- SEARCH QUERY INPUT -->
      <div class="search-card ink-border">
        <div class="search-header">
          <span class="search-caret">&gt;</span> SEARCH_QUERY_INPUT
        </div>
        <div class="search-input-wrapper">
          <input type="text" 
                 class="search-input" 
                 placeholder="Start typing..." 
                 [value]="searchQuery"
                 (input)="onSearchChange($event)">
          <span class="search-cursor" [class.hidden]="searchQuery.length > 0">_</span>
        </div>
      </div>

      <!-- FILTER PROTOCOLS -->
      <div class="filter-card ink-border">
        <div class="filter-tab">FILTER_PROTOCOLS</div>
        <div class="screw top-left"></div>
        <div class="screw top-right"></div>
        
        <div class="filter-list">
          <div *ngFor="let protocol of filterProtocols" class="filter-row">
            <span class="filter-name">{{ protocol.name }}</span>
            <button class="brutalist-toggle" 
                    [class.toggle-active]="protocol.active"
                    (click)="toggleFilter(protocol.name)">
              <div class="toggle-track">
                <div class="toggle-thumb"></div>
              </div>
            </button>
          </div>
        </div>

        <div class="filter-divider"></div>
        <div class="filter-note">
          // ADJUST TOGGLES TO REFINE<br>
          DATA VISUALIZATION
        </div>
        
        <div class="screw bottom-left"></div>
        <div class="screw bottom-right"></div>
      </div>

      <!-- TECH STACK DENSITY -->
      <div class="density-card ink-border">
        <div class="density-header">TECH_STACK_DENSITY</div>
        <div class="density-divider"></div>
        
        <div class="density-list">
          <div *ngFor="let tech of techStackDensity" class="density-item">
            <div class="density-item-header">
              <span class="density-name" [class.density-primary]="tech.isPrimary">
                <span *ngIf="tech.isPrimary" class="material-symbols-outlined density-star">star</span>
                {{ tech.name }}
              </span>
              <span class="density-count">[{{ tech.count }}]</span>
            </div>
            <div class="density-bar-bg">
              <div class="density-bar-fill" [style.width.%]="tech.percentage"></div>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- MAIN TIMELINE -->
    <section class="logs-timeline-section">
      <div class="logs-header">
        <div>
          <h1 class="logs-title">
            Field Logs<br/>
            <span class="transparent-stroke">Archive DB</span>
          </h1>
        </div>
        <div class="logs-stats">
          <div class="logs-total-badge">
            TOTAL_ENTRIES: 42
          </div>
          <p class="logs-meta">
            Last Decryption: 2024.11.08<br/>
            Status: <span class="logs-status-online">ONLINE</span>
          </p>
        </div>
      </div>

      <div class="timeline-container">
        <div class="logs-timeline-line"></div>

        <!-- LOADING SKELETON -->
        <div *ngIf="isLoading" style="opacity: 0.7;">
          <div *ngFor="let i of [1,2,3]" class="timeline-item group timeline-item-even">
            <div class="timeline-date-wrapper">
              <div class="timeline-date-box tag-item-rotate-neg" style="background-color: #e5e7eb; width: 60px; height: 60px;"></div>
            </div>
            
            <div class="timeline-point">
              <div class="timeline-point-inner" style="background-color: #d1d5db;"></div>
            </div>
            
            <div class="timeline-content-wrapper">
              <div class="timeline-content-box" style="transform: rotate(1deg);">
                <div class="timeline-content-inner" style="background-color: #f3f4f6; animation: pulse 2s infinite;">
                  <div style="height: 12px; background-color: #d1d5db; margin-bottom: 24px; width: 40%;"></div>
                  <div style="height: 24px; background-color: #d1d5db; margin-bottom: 16px; width: 80%;"></div>
                  <div style="height: 12px; background-color: #e5e7eb; margin-bottom: 8px; width: 100%;"></div>
                  <div style="height: 12px; background-color: #e5e7eb; margin-bottom: 24px; width: 60%;"></div>
                  <div style="height: 20px; background-color: #d1d5db; width: 100px;"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <ng-container *ngIf="!isLoading">
          <ng-container *ngFor="let log of filteredLogs; let i = index">
          <div class="timeline-item group list-anim-item" 
               [ngClass]="i % 2 === 0 ? 'timeline-item-even' : 'timeline-item-odd'" 
               [routerLink]="['/logs', log.slug]">
             
          <div class="timeline-date-wrapper">
            <div class="timeline-date-box" [ngClass]="i % 2 === 0 ? 'tag-item-rotate-neg' : 'tag-item-rotate-pos'">
              <span class="timeline-date-day">{{ log.createdAt | date:'dd' }}</span>
              <span class="timeline-date-month" [style.color]="i % 2 === 0 ? 'var(--accent-orange)' : 'var(--primary)'">{{ log.createdAt | date:'MMM.yyyy' }}</span>
            </div>
          </div>
          
          <div class="timeline-point">
            <div class="timeline-point-inner" [style.background-color]="i % 2 === 0 ? 'var(--accent-orange)' : 'var(--primary)'"></div>
          </div>
          
          <div class="timeline-content-wrapper">
            <div class="timeline-content-box" [ngStyle]="{'transform': i % 2 === 0 ? 'rotate(1deg)' : 'rotate(-1deg)'}">
              <div class="timeline-content-inner">
                
                <ng-container *ngIf="i % 2 === 0; else alternativeTape">
                  <div class="tape-strip-long" style="top: -15px; right: -40px; transform: rotate(35deg);"></div>
                </ng-container>
                <ng-template #alternativeTape>
                  <div class="tape-strip" style="bottom: -10px; left: 10px; transform: rotate(-5deg); top: auto;"></div>
                </ng-template>

                <div class="timeline-meta-row">
                  <span class="timeline-log-id">LOG_{{ log.id.slice(0, 5) | uppercase }}</span>
                  <div style="display: flex; gap: 0.5rem;">
                    <span class="timeline-status" [ngClass]="i % 2 === 0 ? 'timeline-status-deployed' : 'timeline-status-analyzed'">
                      {{ i % 2 === 0 ? 'DEPLOYED' : 'ANALYZED' }}
                    </span>
                  </div>
                </div>
                
                <h2 class="timeline-log-title" [ngStyle]="{'color': ''}" style="transition: color 0.3s;"
                    [style.color]="'var(--charcoal)'">
                  {{ log.title }}
                </h2>
                
                <p class="timeline-log-preview">
                  {{ log.blocks.length > 0 ? log.blocks[0].content : 'No content' }}
                </p>
                
                <div class="timeline-footer">
                  <div class="timeline-tags">
                    <span *ngFor="let tag of log.tags" class="timeline-tag">#{{ tag }}</span>
                  </div>
                  <button class="btn-decrypt">
                    Decrypt_Full_Log &gt;
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

          <!-- Native Ad every 4th entry -->
          <div *ngIf="(i + 1) % 4 === 0 && i !== filteredLogs.length - 1" class="timeline-ad-slot" style="margin: 1.5rem 0; padding-left: 2.5rem;">
            <app-native-ad></app-native-ad>
          </div>
          </ng-container>
        
          <div *ngIf="filteredLogs.length === 0" class="empty-logs">
             <span class="empty-logs-text">No logs available matching the current criteria.</span>
          </div>
        </ng-container>
      </div>
    </section>
  </div>
</main>
