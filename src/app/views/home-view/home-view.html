<main class="hub-main" id="home">
  <div class="coffee-stain" style="top: 6rem; left: -20px; opacity: 0.4;"></div>
  
  <section class="hub-hero">
    <div class="stamp-join">OPEN<br/>REGISTRY</div>
    
    <div class="hero-content">
      <div class="hero-title-container">
        <div class="hero-title-bg"></div>
        <h1 class="hero-title">
          Craft, Code <br/>
          <span class="transparent-stroke">
            & Collaborate
            <svg preserveAspectRatio="none" viewBox="0 0 100 10">
              <path d="M0 5 Q 50 10 100 5" fill="none" stroke="currentColor" stroke-width="2"></path>
            </svg>
          </span>
        </h1>
      </div>
      
      <p class="hero-subtitle">
        // A decentralized collective for technical documentation, engineering logs, and creative works.
      </p>
      
      <div class="hero-actions">
        <a routerLink="/register" class="btn-primary" *ngIf="!(currentUser | async)">
          <span class="material-symbols-outlined">login</span>
          START_LOGGING
        </a>
        <a routerLink="/logs" class="btn-primary" *ngIf="currentUser | async">
          <span class="material-symbols-outlined">history_edu</span>
          WRITE_A_LOG
        </a>
        <a routerLink="/manifesto" class="btn-secondary">
          READ_MANIFESTO
        </a>
      </div>
    </div>
  </section>
  
  <section class="stats-grid">
    <div class="stat-card rotate-1">
      <div class="stat-header">
        <h3 class="stat-title">Active_Agents</h3>
        <span class="material-symbols-outlined" style="color:var(--charcoal);">group</span>
      </div>
      <div style="text-align: center; padding: 0.5rem 0;">
        <span class="nixie-tube">{{ activeAgents | number:'2.0-0' }}</span>
      </div>
      <div class="stat-footer" style="color: #16a34a;">
        <span class="material-symbols-outlined" style="font-size: 12px;">trending_up</span> SYSTEM_ONLINE
      </div>
    </div>
    
    <div class="stat-card rotate-neg-1" style="z-index: 10;">
      <div class="tape-strip" style="left: 40%; transform: rotate(2deg); opacity: 0.8;"></div>
      <div class="stat-header">
        <h3 class="stat-title">Comm_Logs_Published</h3>
        <span class="material-symbols-outlined" style="color:var(--charcoal);">library_books</span>
      </div>
      <div style="text-align: center; padding: 0.5rem 0;">
        <span class="nixie-tube">{{ publishedLogs | number:'2.0-0' }}</span>
      </div>
      <div style="height: 4px; width: 100%; background-color: #e5e7eb; overflow: hidden; margin-top: 0.5rem;">
        <div style="height: 100%; background-color: var(--accent-orange); width: 75%;"></div>
      </div>
    </div>
    
    <div class="stat-card rotate-2">
      <div class="stat-header">
        <h3 class="stat-title">Works_Archived</h3>
        <span class="material-symbols-outlined" style="color:var(--charcoal);">inventory_2</span>
      </div>
      <div style="text-align: center; padding: 0.5rem 0;">
        <span class="nixie-tube">{{ archivedWorks | number:'2.0-0' }}</span>
      </div>
      <div class="stat-footer">
        LAST UPDATE: {{ uptime() }} AGO
      </div>
    </div>
  </section>
  
  <div class="main-grid">
    <aside class="side-panel">
      <!-- Directory Box -->
      <div class="directory-box">
        <div class="directory-header">
          <span>DIRECTORY</span>
          <span class="material-symbols-outlined" style="font-size: 14px;">folder_open</span>
        </div>
        <ul class="directory-list">
          <li>
            <a routerLink="/logs" class="directory-link">
              <span class="material-symbols-outlined">terminal</span>
              <span>Dev_Logs</span>
            </a>
          </li>
          <li>
            <a routerLink="/works" class="directory-link">
              <span class="material-symbols-outlined">architecture</span>
              <span>Design_Blueprints</span>
            </a>
          </li>
          <li>
            <a routerLink="#" class="directory-link">
              <span class="material-symbols-outlined">build</span>
              <span>Workshop_Guides</span>
            </a>
          </li>
          <li>
            <a routerLink="#" class="directory-link">
              <span class="material-symbols-outlined">forum</span>
              <span>Open_Channels</span>
            </a>
          </li>
        </ul>
      </div>
      
      <!-- Trending Signal (Top 5 by engagement) -->
      <div class="trending-box">
        <h4 class="trending-title">Top_Engagement</h4>
        <div class="trending-list">
          <div class="trending-item" *ngFor="let tLog of trendingLogs; let i = index">
            <span class="trending-num">#{{ i + 1 }}</span>
            <div>
              <p class="trending-text" [routerLink]="['/' + (tLog.category === 'work' ? 'works' : 'logs'), tLog.slug]">{{ tLog.title }}</p>
              <span class="trending-meta">
                <span *ngIf="tLog.author">@{{ tLog.author.username }} Â· </span>
                <span style="color: var(--accent-orange);">â†‘{{ upvoteCounts[tLog.id] || 0 }}</span>
                <span> Â· </span>
                <span style="color: var(--primary);">ðŸ’¬{{ commentCounts[tLog.id] || 0 }}</span>
              </span>
            </div>
          </div>
          <div *ngIf="trendingLogs.length === 0" class="trending-meta">No signals detected.</div>
        </div>
      </div>
    </aside>
    
    <div class="center-panel">
      <!-- DYNAMIC LOGS WITH REAL SOCIAL DATA -->
      <ng-container *ngFor="let log of logs; let first = first">
        <a [routerLink]="['/logs', log.slug]" class="post-card">
          <div *ngIf="first && (upvoteCounts[log.id] || 0) + (commentCounts[log.id] || 0) > 0" class="hot-topic-badge">TOP_POST</div>
          <div class="post-content">
            <div class="post-meta">
              <span style="display:flex; align-items:center; gap:0.25rem;"><span class="material-symbols-outlined" style="font-size:12px;">account_circle</span> @{{ log.author?.username || 'sys_admin_01' }}</span>
              <span>â€¢</span>
              <span>{{ log.createdAt | date:'MMM dd yyyy' }}</span>
              <span *ngIf="log.tags.length">
                <span>â€¢</span>
                <span class="post-tag">#{{log.tags[0]}}</span>
              </span>
            </div>
            <h3 class="post-title">
              {{ log.title }}
            </h3>
            <p class="post-body">
              {{ log.blocks.length > 0 ? (log.blocks[0].content | slice:0:150) + '...' : 'System analysis indicates optimal function. Further metrics pending...' }}
            </p>
            <div class="post-footer">
              <div class="post-actions">
                <span class="post-action-btn" (click)="$event.preventDefault()"><span class="material-symbols-outlined" style="font-size:14px;">arrow_upward</span> {{ upvoteCounts[log.id] || 0 }}</span>
                <span class="post-action-btn" (click)="$event.preventDefault()"><span class="material-symbols-outlined" style="font-size:14px;">chat_bubble</span> {{ commentCounts[log.id] || 0 }} Comments</span>
                <span class="post-action-btn" (click)="$event.preventDefault()"><span class="material-symbols-outlined" style="font-size:14px;">share</span></span>
              </div>
              <span class="post-id">ID: {{ log.category === 'work' ? 'WORK' : 'LOG' }}_{{ log.id.substring(0,4).toUpperCase() }}</span>
            </div>
          </div>
        </a>
      </ng-container>
      
      <div style="text-align: center; padding: 1rem 0;" *ngIf="hasMoreLogs">
        <button class="load-more-btn" (click)="loadMoreLogs()" [disabled]="isLoadingMore">
          {{ isLoadingMore ? 'LOADING_SIGNAL...' : 'LOAD_MORE_LOGS_â†“' }}
        </button>
      </div>
    </div>
    
    <aside class="side-panel">
      <!-- Join Guild Box -->
      <div class="guild-box">
        <div class="guild-blob"></div>
        <h3 class="guild-title">Join The Guild</h3>
        <p class="guild-desc">
          Become a verified agent. Access private channels, workshop tools, and contribute to the core repo.
        </p>
        <button class="guild-btn" routerLink="/register">INITIATE_SIGNUP</button>
      </div>
      
      <!-- Activity Box -->
      <div class="activity-box">
        <div class="activity-header">
          <h4 class="activity-title">Recent_Activity</h4>
          <div class="activity-dot"></div>
        </div>
        <ul class="activity-list">
          <li class="activity-item" *ngFor="let activity of recentActivities">
            <span class="activity-time">{{ activity.time | date:'HH:mm' }}</span>
            <span *ngIf="activity.category === 'log'">
              @{{ activity.author }} logged 
              <a [routerLink]="['/logs', activity.slug]" style="color:var(--primary); font-weight:bold; text-decoration: none;">{{ activity.title | slice:0:15 }}{{activity.title.length > 15 ? '...' : ''}}</a>
            </span>
            <span *ngIf="activity.category === 'work'">
              @{{ activity.author }} deployed 
              <a [routerLink]="['/works', activity.slug]" style="color:var(--accent-orange); font-weight:bold; text-decoration: none;">{{ activity.title | slice:0:15 }}{{activity.title.length > 15 ? '...' : ''}}</a>
            </span>
          </li>
          <li class="activity-item" *ngIf="recentActivities.length === 0">
            <span class="activity-time">XX:XX</span>
            <span>No recent activity detected.</span>
          </li>
        </ul>
      </div>
      
      <!-- Sponsored Box -->
      <div class="sponsored-box">
        <span class="sponsored-label">SPONSORED_TRANSMISSION</span>
        <div class="sponsored-banner">
          <p class="sponsored-banner-text">Mechanical<br/>Keyboards</p>
        </div>
        <p class="sponsored-desc">Upgrade your input terminal today.</p>
      </div>
    </aside>
  </div>
</main>


